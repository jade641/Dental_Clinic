@page "/admin-analytics"
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager Navigation

<link rel="stylesheet" href="~/css/AdminAnalytics.css">

<div class="page-wrapper">
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2L2 7v10c0 5.5 3.8 9.7 10 11 6.2-1.3 10-5.5 10-11V7l-10-5z" stroke="#0ea5e9" stroke-width="2" />
                </svg>
            </div>
            <div class="clinic-info">
                <h1>AURELIA DENTAL CLINIC - DR JADE</h1>
                <p>YOUR SMILE, OUR MASTERPIECE</p>
            </div>
        </div>

        <nav class="nav-menu">
            <NavLink href="/admin-dashboard" class="nav-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                </svg>
                Overview
            </NavLink>
            <NavLink href="/admin-analytics" class="nav-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3v18h18" />
                    <path d="M18 17V9" />
                    <path d="M13 17V5" />
                    <path d="M8 17v-3" />
                </svg>
                Analytics
            </NavLink>
            <NavLink href="/admin-reports" class="nav-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                </svg>
                Reports
            </NavLink>
            <NavLink href="/admin-users" class="nav-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75" />
                </svg>
                Users
            </NavLink>
            <NavLink href="/admin-marketing" class="nav-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                Marketing
            </NavLink>
        </nav>

        <div class="search-section">
            <div class="search-bar">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2">
                    <circle cx="11" cy="11" r="8" />
                    <path d="M21 21l-4.35-4.35" />
                </svg>
                <input type="text" placeholder="Search reports, users..." @bind="searchQuery">
            </div>
            <button class="icon-btn" @onclick="ShowNotifications">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9" />
                    <path d="M13.73 21a2 2 0 01-3.46 0" />
                </svg>
            </button>
            <button class="icon-btn" @onclick="ToggleTheme">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3" />
                    <path d="M12 1v6m0 6v6m5.196-15.196l-4.243 4.243m0 5.906l-4.243 4.243m12.728 0l-4.243-4.243m0-5.906l-4.243-4.243" />
                </svg>
            </button>
            <div class="user-profile">
                <div class="avatar">DA</div>
                <div class="user-info">
                    <div class="user-name">Dr. Admin</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h2>Analytics Dashboard</h2>
            <div class="header-actions">
                <select class="date-select" @bind="selectedPeriod" @bind:event="onchange">
                    <option value="7">Last 7 days</option>
                    <option value="30">Last 30 days</option>
                    <option value="90">Last 3 months</option>
                    <option value="365">Last year</option>
                </select>
                <button class="export-btn" @onclick="ExportData">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                    Export
                </button>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Weekly Performance Chart -->
            <div class="card card-large">
                <h3 class="card-title">Weekly Performance</h3>
                <div class="chart-container">
                    <canvas id="weeklyChart"></canvas>
                </div>
            </div>

            <!-- Service Revenue Breakdown -->
            <div class="card">
                <h3 class="card-title">Service Revenue Breakdown</h3>
                <div class="revenue-list">
                    @foreach (var item in serviceRevenue)
                    {
                        <div class="revenue-item">
                            <div class="revenue-info">
                                <span class="revenue-indicator" style="background-color: @item.Color"></span>
                                <span class="revenue-service">@item.Service</span>
                            </div>
                            <div class="revenue-stats">
                                <span class="revenue-amount">₱@item.Amount.ToString("N0")</span>
                                <span class="revenue-percentage">@item.Percentage% of total</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    window.initWeeklyChart = function() {
        const ctx = document.getElementById('weeklyChart');
        if (!ctx) return;
        
        new Chart(ctx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                    {
                        label: 'Patients',
                        data: [12, 15, 18, 20, 16, 14, 8],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Revenue',
                        data: [18000, 22000, 28000, 32000, 24000, 20000, 12000],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        min: 0,
                        max: 25,
                        ticks: {
                            stepSize: 5
                        },
                        grid: {
                            drawBorder: false,
                            color: '#f3f4f6'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        min: 0,
                        max: 40000,
                        ticks: {
                            stepSize: 8000
                        },
                        grid: {
                            drawOnChartArea: false,
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    };
</script>

@code {
    private string searchQuery = "";
    private string selectedPeriod = "7";

    private List<ServiceRevenueItem> serviceRevenue = new()
    {
        new ServiceRevenueItem { Service = "Teeth Cleaning", Amount = 87500, Percentage = 35, Color = "#3b82f6" },
        new ServiceRevenueItem { Service = "Dental Filling", Amount = 87500, Percentage = 25, Color = "#10b981" },
        new ServiceRevenueItem { Service = "Root Canal", Amount = 225000, Percentage = 15, Color = "#06b6d4" },
        new ServiceRevenueItem { Service = "Teeth Whitening", Amount = 96000, Percentage = 12, Color = "#f59e0b" },
        new ServiceRevenueItem { Service = "Braces", Amount = 240000, Percentage = 8, Color = "#ef4444" },
        new ServiceRevenueItem { Service = "Others", Amount = 45000, Percentage = 5, Color = "#6b7280" }
    };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initWeeklyChart");
        }
    }

    private void ShowNotifications()
    {
        // Show notifications logic
    }

    private void ToggleTheme()
    {
        // Toggle theme logic
    }

    private void ExportData()
    {
        // Export data logic
        Console.WriteLine($"Exporting analytics data for period: {selectedPeriod} days");
    }

    public class ServiceRevenueItem
    {
        public string Service { get; set; } = "";
        public int Amount { get; set; }
        public int Percentage { get; set; }
        public string Color { get; set; } = "";
    }

    [Inject]
    private IJSRuntime JSRuntime { get; set; } = default!;
}