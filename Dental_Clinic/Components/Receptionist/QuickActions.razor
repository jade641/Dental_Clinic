@using Microsoft.AspNetCore.Components

<link href="css/QuickActions.css" rel="stylesheet" />

<div class="quick-actions-component">
    <div class="quick-actions-grid">
        <button class="action-button blue" @onclick="OpenScheduleAppointmentModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            Schedule Appointment
        </button>
        <button class="action-button teal" @onclick="OpenRegisterPatientModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
            </svg>
            Register Patient
        </button>
        <button class="action-button purple" @onclick="OpenWaitingRoomModal">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            Waiting Room
        </button>
    </div>
</div>

<!-- Schedule Appointment Modal -->
@if (showScheduleModal)
{
    <div class="modal-overlay" @onclick="CloseScheduleModal">
        <div class="modal-content schedule-modal" @onclick:stopPropagation>
            <div class="modal-header">
                <h3>Schedule New Appointment</h3>
                <button class="close-btn" @onclick="CloseScheduleModal">×</button>
            </div>
            <p class="modal-subtitle">Fill in the details to schedule a new appointment</p>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>Patient Name</label>
                        <input type="text" @bind="patientName" placeholder="Select or enter patient name" />
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" @bind="phoneNumber" placeholder="+63 9XX XXX XXXX" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Appointment Date</label>
                        <input type="date" @bind="appointmentDate" />
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" @bind="appointmentTime" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Service</label>
                        <select @bind="selectedService">
                            <option value="">Select service</option>
                            <option value="Teeth Cleaning">Teeth Cleaning</option>
                            <option value="Root Canal">Root Canal</option>
                            <option value="Dental Filling">Dental Filling</option>
                            <option value="Tooth Extraction">Tooth Extraction</option>
                            <option value="Orthodontics">Orthodontics</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Dentist</label>
                        <select @bind="selectedDentist">
                            <option value="">Select dentist</option>
                            <option value="Dr. Jade">Dr. Jade</option>
                            <option value="Dr. Smith">Dr. Smith</option>
                            <option value="Dr. Johnson">Dr. Johnson</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea @bind="notes" rows="3" placeholder="Any special notes or requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" @onclick="CloseScheduleModal">Cancel</button>
                <button class="btn-primary blue" @onclick="ScheduleAppointment">Schedule Appointment</button>
            </div>
        </div>
    </div>
}

<!-- Register Patient Modal -->
@if (showRegisterModal)
{
    <div class="modal-overlay" @onclick="CloseRegisterModal">
        <div class="modal-content register-modal" @onclick:stopPropagation>
            <div class="modal-header">
                <h3>Register New Patient</h3>
                <button class="close-btn" @onclick="CloseRegisterModal">×</button>
            </div>
            <p class="modal-subtitle">Enter patient information to create a new record</p>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" @bind="firstName" placeholder="Juan" />
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" @bind="lastName" placeholder="Dela Cruz" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" @bind="patientPhone" placeholder="+63 9XX XXX XXXX" />
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" @bind="email" placeholder="patient@email.com" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" @bind="dateOfBirth" />
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select @bind="gender">
                            <option value="">Select gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" @bind="address" placeholder="Complete address..." />
                </div>
                <div class="form-group">
                    <label>Emergency Contact</label>
                    <input type="text" @bind="emergencyContact" placeholder="Name and phone number" />
                </div>
                <div class="form-group">
                    <label>Medical History (Optional)</label>
                    <textarea @bind="medicalHistory" rows="3" placeholder="Allergies, medications, conditions..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" @onclick="CloseRegisterModal">Cancel</button>
                <button class="btn-primary teal" @onclick="RegisterPatient">Register Patient</button>
            </div>
        </div>
    </div>
}

<!-- Waiting Room Modal -->
@if (showWaitingRoomModal)
{
    <div class="modal-overlay" @onclick="CloseWaitingRoomModal">
        <div class="modal-content waiting-room-modal" @onclick:stopPropagation>
            <div class="modal-header">
                <div class="header-with-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <h3>Waiting Room - 1 Patient(s) Waiting</h3>
                </div>
                <button class="close-btn" @onclick="CloseWaitingRoomModal">×</button>
            </div>
            <p class="modal-subtitle">Manage patients currently in the waiting room</p>
            <div class="modal-body waiting-room-body">
                @if (waitingPatients.Any())
                {
                    @foreach (var patient in waitingPatients)
                    {
                        <div class="waiting-patient-card">
                            <div class="patient-avatar">@patient.Initials</div>
                            <div class="patient-info">
                                <h4 class="patient-name-waiting">@patient.Name</h4>
                                <p class="patient-service">@patient.Service</p>
                                <div class="patient-details">
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                        <span>Scheduled: @patient.ScheduledTime</span>
                                    </div>
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                        <span>@patient.Dentist</span>
                                    </div>
                                    <div class="detail-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                        </svg>
                                        <span>@patient.Phone</span>
                                    </div>
                                </div>
                                @if (patient.IsFirstTime)
                                {
                                    <span class="first-time-badge">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="16" x2="12" y2="12"></line>
                                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                        </svg>
                                        First time patient
                                    </span>
                                }
                            </div>
                            <div class="patient-actions">
                                <button class="action-btn call-btn" @onclick="() => CallPatient(patient.Id)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Call Patient
                                </button>
                                <button class="action-btn sms-btn" @onclick="() => SendSMS(patient.Id)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    Send SMS
                                </button>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p>No patients in waiting room</p>
                    </div>
                }
            </div>
        </div>
    </div>
}

@code {
    // Modal visibility flags
    private bool showScheduleModal = false;
    private bool showRegisterModal = false;
    private bool showWaitingRoomModal = false;

    // Schedule Appointment fields
    private string patientName = "";
    private string phoneNumber = "";
    private DateTime? appointmentDate;
    private TimeOnly? appointmentTime;
    private string selectedService = "";
    private string selectedDentist = "";
    private string notes = "";

    // Register Patient fields
    private string firstName = "";
    private string lastName = "";
    private string patientPhone = "";
    private string email = "";
    private DateTime? dateOfBirth;
    private string gender = "";
    private string address = "";
    private string emergencyContact = "";
    private string medicalHistory = "";

    // Waiting Room data
    private List<WaitingPatient> waitingPatients = new List<WaitingPatient>
    {
        new WaitingPatient
        {
            Id = 1,
            Name = "Maria Rodriguez",
            Initials = "MR",
            Service = "Teeth Cleaning",
            ScheduledTime = "9:00 AM",
            Dentist = "Dr. Jade",
            Phone = "+63 912 345 6789",
            IsFirstTime = true
        }
    };

    // Modal control methods
    private void OpenScheduleAppointmentModal()
    {
        showScheduleModal = true;
    }

    private void CloseScheduleModal()
    {
        showScheduleModal = false;
        ResetScheduleForm();
    }

    private void OpenRegisterPatientModal()
    {
        showRegisterModal = true;
    }

    private void CloseRegisterModal()
    {
        showRegisterModal = false;
        ResetRegisterForm();
    }

    private void OpenWaitingRoomModal()
    {
        showWaitingRoomModal = true;
    }

    private void CloseWaitingRoomModal()
    {
        showWaitingRoomModal = false;
    }

    // Action methods
    private void ScheduleAppointment()
    {
        // TODO: Implement appointment scheduling logic
        CloseScheduleModal();
    }

    private void RegisterPatient()
    {
        // TODO: Implement patient registration logic
        CloseRegisterModal();
    }

    private void CallPatient(int patientId)
    {
        // TODO: Implement call patient logic
    }

    private void SendSMS(int patientId)
    {
        // TODO: Implement send SMS logic
    }

    // Reset form methods
    private void ResetScheduleForm()
    {
        patientName = "";
        phoneNumber = "";
        appointmentDate = null;
        appointmentTime = null;
        selectedService = "";
        selectedDentist = "";
        notes = "";
    }

    private void ResetRegisterForm()
    {
        firstName = "";
        lastName = "";
        patientPhone = "";
        email = "";
        dateOfBirth = null;
        gender = "";
        address = "";
        emergencyContact = "";
        medicalHistory = "";
    }

    // Waiting Patient model
    public class WaitingPatient
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";
        public string Initials { get; set; } = "";
        public string Service { get; set; } = "";
        public string ScheduledTime { get; set; } = "";
        public string Dentist { get; set; } = "";
        public string Phone { get; set; } = "";
        public bool IsFirstTime { get; set; }
    }
}
