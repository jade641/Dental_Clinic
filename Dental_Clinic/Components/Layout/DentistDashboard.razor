@page "/dentist-dashboard"
@using Microsoft.AspNetCore.Components.Routing
@inject NavigationManager Navigation
@implements IDisposable

<link href="css/dentistdashboard.css" rel="stylesheet" />

<div class="dashboard-page">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <!-- Brand -->
            <a href="/dentist-dashboard" class="navbar-brand" @onclick:preventDefault @onclick="@(() => NavigateTo("/dentist-dashboard"))">
                <div class="navbar-logo">
                    <img src="css/bootstrap/Dental_Logo.png" alt="Aurelia Dental Clinic Logo" class="clinic-logo-img" />
                </div>
                <div class="navbar-brand-text">
                    <h1>AURELIA DENTAL CLINIC - DR JADE</h1>
                    <p>YOUR SMILE. OUR MASTERPIECE</p>
                </div>
            </a>

            <!-- Nav Links -->
            <div class="navbar-menu">
                <ul class="nav-links">
                    <li>
                        <a href="/dentist-dashboard" class="nav-link @(GetActiveClass("/dentist-dashboard"))" @onclick:preventDefault @onclick="@(() => NavigateTo("/dentist-dashboard"))">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                            </svg>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li>
                        <a href="/schedule" class="nav-link @(GetActiveClass("/schedule"))" @onclick:preventDefault @onclick="@(() => NavigateTo("/schedule"))">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" />
                                <line x1="16" y1="2" x2="16" y2="6" />
                                <line x1="8" y1="2" x2="8" y2="6" />
                                <line x1="3" y1="10" x2="21" y2="10" />
                            </svg>
                            <span>Schedule</span>
                        </a>
                    </li>
                    <li>
                        <a href="/patients" class="nav-link @(GetActiveClass("/patients"))" @onclick:preventDefault @onclick="@(() => NavigateTo("/patients"))">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M23 21v-2a4 4 0 00-3-3.87m-4-12a4 4 0 010 7.75" />
                            </svg>
                            <span>Patients</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Actions -->
            <div class="navbar-actions">
                <div class="search-box">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.35-4.35" />
                    </svg>
                    <input type="text" placeholder="Search patients, appointments..." @bind="searchQuery" @bind:event="oninput" />
                </div>

                <button class="icon-btn notification-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                    </svg>
                </button>

                <button class="settings-btn" title="Settings" aria-label="Open settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24" />
                    </svg>
                </button>

                <div class="user-profile">
                    <div class="user-avatar">DS</div>
                    <div class="user-info">
                        <div class="user-name">Dr. Staff</div>
                        <div class="user-role">Staff Portal</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="dashboard-content">
        <!-- Hero Card -->
        <div class="hero-card">
            <div class="hero-content">
                <div class="hero-text">
                    <h1>Good morning, Dr. Jade!</h1>
                    <p class="subtitle">Ready to make smiles brighter today?</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Today's Appointments</div>
                        <div class="stat-value">@todayAppointmentsCount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Completed</div>
                        <div class="stat-value">@completedCount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Patients</div>
                        <div class="stat-value">@totalPatientsCount</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Treatments</div>
                        <div class="stat-value">@pendingTreatmentsCount</div>
                    </div>
                </div>
            </div>

            <div class="hero-icon">
                <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M60 85C77.6731 85 92 70.6731 92 53C92 35.3269 77.6731 21 60 21C42.3269 21 28 35.3269 28 53C28 70.6731 42.3269 85 60 85Z" stroke="white" stroke-width="3" stroke-opacity="0.3" />
                    <path d="M60 75C71.598 75 81 65.598 81 54C81 42.402 71.598 33 60 33C48.402 33 39 42.402 39 54C39 65.598 48.402 75 60 75Z" fill="white" fill-opacity="0.15" />
                    <circle cx="52" cy="50" r="4" fill="white" fill-opacity="0.4" />
                    <circle cx="68" cy="50" r="4" fill="white" fill-opacity="0.4" />
                    <path d="M48 62C48 62 52 68 60 68C68 68 72 62 72 62" stroke="white" stroke-width="3" stroke-linecap="round" stroke-opacity="0.4" />
                </svg>
            </div>
        </div>

        <!-- Today's Schedule Section -->
        <div class="schedule-section">
            <div class="section-header">
                <div class="section-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <h2>Today's Schedule</h2>
                </div>
                <div class="appointment-badge">@appointments.Count appointments</div>
            </div>

            <div class="schedule-list">
                @if (appointments.Count == 0)
                {
                    <div class="no-appointments">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                            <line x1="16" y1="2" x2="16" y2="6" />
                            <line x1="8" y1="2" x2="8" y2="6" />
                            <line x1="3" y1="10" x2="21" y2="10" />
                        </svg>
                        <p>No appointments scheduled for today</p>
                    </div>
                }
                else
                {
                    @foreach (var appointment in appointments)
                    {
                        <div class="appointment-item">
                            <div class="appt-time">
                                <div class="time-icon-wrapper">
                                    <svg class="time-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10" />
                                        <polyline points="12 6 12 12 16 14" />
                                    </svg>
                                </div>
                                <div class="time-info">
                                    <div class="time">@appointment.Time</div>
                                </div>
                            </div>
                            <div class="appt-details">
                                <div class="patient-name">@appointment.PatientName</div>
                                <div class="treatment-info">@appointment.Treatment • @appointment.Duration min</div>
                            </div>
                            <div class="appt-actions">
                                <span class="status-badge status-@appointment.StatusClass">@appointment.Status</span>
                                <button class="menu-btn" @onclick="() => ShowAppointmentMenu(appointment.Id)" title="More options">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="5" r="2" />
                                        <circle cx="12" cy="12" r="2" />
                                        <circle cx="12" cy="19" r="2" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>

@code {
    private string searchQuery = string.Empty;
    private string currentUrl = string.Empty;
    private int todayAppointmentsCount = 4;
    private int completedCount = 1;
    private int totalPatientsCount = 156;
    private int pendingTreatmentsCount = 12;
    private List<Appointment> appointments = new List<Appointment>();

    protected override void OnInitialized()
    {
        LoadAppointments();
        currentUrl = Navigation.Uri;
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = e.Location;
        StateHasChanged();
    }

    private string GetActiveClass(string path)
    {
        var uri = new Uri(Navigation.Uri);
        var currentPath = uri.AbsolutePath;
        return currentPath == path ? "active" : "";
    }

    private void NavigateTo(string path)
    {
        Navigation.NavigateTo(path, forceLoad: false);
    }

    private void LoadAppointments()
    {
        appointments = new List<Appointment>
        {
            new Appointment
            {
                Id = 1,
                Time = "9:00 AM",
                PatientName = "Maria Rodriguez",
                Treatment = "Teeth Cleaning",
                Duration = 60,
                Status = "confirmed",
                StatusClass = "confirmed"
            },
            new Appointment
            {
                Id = 2,
                Time = "10:30 AM",
                PatientName = "Juan Santos",
                Treatment = "Root Canal Follow-up",
                Duration = 45,
                Status = "in-progress",
                StatusClass = "progress"
            },
            new Appointment
            {
                Id = 3,
                Time = "2:00 PM",
                PatientName = "Ana Dela Cruz",
                Treatment = "Dental Consultation",
                Duration = 30,
                Status = "confirmed",
                StatusClass = "confirmed"
            },
            new Appointment
            {
                Id = 4,
                Time = "3:30 PM",
                PatientName = "Carlos Martinez",
                Treatment = "Dental Check-up",
                Duration = 30,
                Status = "confirmed",
                StatusClass = "confirmed"
            }
        };

        todayAppointmentsCount = appointments.Count;
        completedCount = appointments.Count(a => a.Status == "completed");
    }

    private void ShowAppointmentMenu(int appointmentId)
    {
        Console.WriteLine($"Show menu for appointment {appointmentId}");
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }

    public class Appointment
    {
        public int Id { get; set; }
        public string Time { get; set; } = string.Empty;
        public string PatientName { get; set; } = string.Empty;
        public string Treatment { get; set; } = string.Empty;
        public int Duration { get; set; }
        public string Status { get; set; } = string.Empty;
        public string StatusClass { get; set; } = string.Empty;
    }
}